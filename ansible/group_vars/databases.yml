---
# Переменные для серверов баз данных

# ==================================
# PostgreSQL конфигурация
# ==================================
postgresql_version: "15"
postgresql_listen_addresses: "localhost"
postgresql_port: 5432

# Производительность
postgresql_max_connections: 100
postgresql_shared_buffers: "256MB"
postgresql_effective_cache_size: "1GB"
postgresql_work_mem: "4MB"
postgresql_maintenance_work_mem: "64MB"

# ==================================
# Databases
# ==================================
postgresql_databases:
  - name: myapp_production
    encoding: UTF8
    lc_collate: en_US.UTF-8
    lc_ctype: en_US.UTF-8

# ==================================
# Users
# ==================================
postgresql_users:
  - name: myapp_user
    password: "{{ vault_db_password }}"  # Из vault
    database: myapp_production
    priv: "ALL"

# ==================================
# Backup настройки
# ==================================
backup_enabled: true
backup_directory: /var/backups/postgresql
backup_retention_days: 7
backup_schedule: "0 2 * * *"  # Каждый день в 2:00

# ==================================
# Репликация (для replica серверов)
# ==================================
postgresql_replication_enabled: false
postgresql_primary_host: "db-primary.example.com"
postgresql_replication_user: replicator
postgresql_replication_password: "{{ vault_replication_password }}"

# ==================================
# Мониторинг
# ==================================
postgresql_log_min_duration_statement: 1000  # ms
postgresql_log_connections: true
postgresql_log_disconnections: true
postgresql_log_line_prefix: "%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h "
